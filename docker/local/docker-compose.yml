version: "3"
services:
  api:
    image: champon1020/argus:0.6
    container_name: argus_dev
    environment:
      ARGUS_MODE: "dev"
      ARGUS_LOG_PATH: "/logs"
      ARGUS_CONFIG_PATH: "/config.json"
      ARGUS_RESOURCE_PATH: "/usr/share/nginx/html"
      ARGUS_SECRET_PATH: "/secret.json"
      ARGUS_KEY_PATH: "/public_key.pem"
      ARGUS_USER_PATH: "/user.json"
      ARGUS_DB_USER: "root"
      ARGUS_DB_PASS: "toor"
      ARGUS_DB_PORT: "3306"
      ARGUS_DB_HOST: "172.30.0.3"
      ARGUS_DB_NAME: "argus_test"
    ports:
      - "8000:8000"
    volumes:
      - "../../resource_debug:/usr/share/nginx/html"
      - "../../argus-private/config.json:/config.json"
      - "${ARGUS_SECRET_PATH}:/secret.json"
      - "${ARGUS_USER_PATH}:/user.json"
    networks:
      devnet_default:
        ipv4_address: 172.30.0.2

  db:
    image: champon1020/argus-db:0.2
    container_name: argus_db_dev
    environment:
      MYSQL_ROOT_PASSWORD: toor
      MYSQL_ROOT_HOST: '%'
      MYSQL_DATABASE: argus_test
      MYSQL_USER: docker
      MYSQL_PASSWORD: docker
      INTERNAL_IP: 127.0.0.1
      TZ: "Asia/Tokyo"
    ports:
      - "43306:3306"
#    volumes:
#      - "../db/entry:/docker-entrypoint-initdb.d"
#      - "../db/custom.cnf:/etc/mysql/conf.d/custom.cnf"
#      - "../db/data:/docker/db/csv"
    networks:
      devnet_default:
        ipv4_address: 172.30.0.3

  file_server:
    image: champon1020/argus-file-server:0.2
    container_name: argus_file_dev
    ports:
      - "8081:80"
    volumes:
      - "../../resource_debug:/usr/share/nginx/html/resrc"

networks:
  devnet_default:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.30.0.1/24